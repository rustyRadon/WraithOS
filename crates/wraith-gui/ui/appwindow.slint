import { Button, VerticalBox, LineEdit } from "std-widgets.slint";

export component AppWindow inherits Window {
    title: "WRAITH OS | THE RITUAL";
    min-width: 1000px;
    min-height: 950px;
    background: #000000;

    callback generate_identity();
    callback manifest_identity(string);
    callback copy_node_id();
    
    in property <string> node_id: "VOID_NODE";
    in-out property <[string]> words: ["","","","","","","","","","","","","","","","","","","","","","","",""];
    in-out property <int> active_socket: -1;
    in-out property <bool> manifesting: false;

    Image {
        source: @image-url("../images/img1.png");
        width: 100%; height: 100%; image-fit: cover;
        opacity: root.manifesting ? 0.4 : 0.15;
        animate opacity { duration: 1500ms; easing: ease-in-out; }
    }

    Rectangle {
        background: @radial-gradient(circle, #00000000 0%, #000000dd 85%);
    }

    VerticalLayout {
        padding: 50px; spacing: 40px; alignment: center;

        Text {
            text: root.manifesting ? "â›§ W E L C O M E   H O M E â›§" : "â›§ W R A I T H   O S â›§";
            font-size: 48px;
            font-weight: 900;
            color: root.manifesting ? #00ffcc : #ff3333;
            horizontal-alignment: center;
            letter-spacing: 22px;
            animate color { duration: 1000ms; }
            
            opacity: 0.8 + Math.sin((animation-tick() / 150ms) * 1rad) * 0.2;
        }

        Rectangle {
            height: 580px; width: 850px;
            for row_idx in 4: HorizontalLayout {
                y: row_idx * 145px; spacing: 35px; alignment: center;
                for col_idx in 6: socket-container := Rectangle { 
                    property <int> idx: row_idx * 6 + col_idx;
                    width: 100px; height: 100px;

                    property <float> t: animation-tick() / 1ms;
                    property <length> off_x: Math.sin((t / 2500.0 + (idx * 0.6)) * 1rad) * 15px;
                    property <length> off_y: Math.cos((t / 2500.0 + (idx * 0.6)) * 1rad) * 15px;

                    TouchArea {
                        clicked => { root.active_socket = idx; }
                        
                        Rectangle {
                            x: socket-container.off_x + (parent.width - self.width) / 2;
                            y: socket-container.off_y + (parent.height - self.height) / 2;
                            width: 80px; height: 80px; border-radius: 40px;
                            
                            background: root.active_socket == idx 
                                ? #ff333366 
                                : (root.manifesting ? #00ffcc15 : #0a0a0a);
                            
                            border-width: root.active_socket == idx ? 3px : 1.5px;
                            border-color: root.words[idx] == "" 
                                ? #222 
                                : (root.manifesting ? #00ffcc : #ff3333);
                            
                            drop-shadow-blur: root.manifesting ? 20px : 0px;
                            drop-shadow-color: #00ffcc66;

                            animate background, border-color, width, height { duration: 400ms; easing: ease-out; }

                            Text {
                                text: root.manifesting ? "" : (root.words[idx] == "" ? "\{idx + 1}" : "âš¸");
                                color: root.words[idx] == "" ? #444 : #ff3333;
                                font-size: 16px;
                                font-family: "monospace";
                            }
                        }
                    }
                }
            }
        }

        if (!root.manifesting) : Rectangle {
            width: 550px; height: 100px;
            background: #050505f0; 
            border-radius: 2px; 
            border-width: 1px; 
            border-color: #ff333333;
            
            VerticalLayout {
                padding: 15px; spacing: 8px;
                Text {
                    text: root.active_socket == -1 
                        ? ">> STANDBY: SELECT A SOCKET TO INJECT IDENTITY" 
                        : ">> INJECTING DATA INTO NODE #\{root.active_socket + 1}...";
                    color: #ff3333; font-family: "monospace"; font-size: 11px;
                    letter-spacing: 1px;
                }
                LineEdit {
                    placeholder-text: "awaiting ritual word...";
                    enabled: root.active_socket != -1;
                    font-size: 18px;
                    accepted(val) => {
                        root.words[root.active_socket] = val;
                        if (root.active_socket < 23) { root.active_socket += 1; }
                        self.text = "";
                    }
                }
            }
        }

        if (root.manifesting) : Rectangle {
            width: 700px; height: 80px;
            background: #00ffcc08; border-radius: 40px; border-width: 1px; border-color: #00ffcc44;
            
            HorizontalLayout {
                padding-left: 30px; padding-right: 30px; spacing: 20px;
                alignment: center;
                Text {
                    text: "NODE ID:"; color: #00ffcc88; font-weight: 800; vertical-alignment: center;
                }
                Text {
                    text: root.node_id; color: #00ffcc; font-family: "monospace"; 
                    vertical-alignment: center; font-size: 12px;
                }
                Button {
                    text: "COPY"; width: 80px; height: 35px;
                    clicked => { root.copy_node_id() }
                }
            }
        }

        HorizontalLayout {
            spacing: 30px; alignment: center;
            
            if (!root.manifesting) : Button {
                text: "â›§ SUMMON NEW â›§";
                width: 200px; height: 55px;
                clicked => { root.generate_identity(); }
            }

            Button {
                text: root.manifesting ? "ðŸ”¥ B A N I S H ðŸ”¥" : "â›§ M A N I F E S T â›§";
                width: 300px; height: 60px;
                clicked => { 
                    if (root.manifesting) {
                        root.manifesting = false;
                        root.words = ["","","","","","","","","","","","","","","","","","","","","","","",""];
                    } else {
                        root.manifest_identity("exec");
                    }
                }
            }
        }
    }
}